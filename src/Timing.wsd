@startuml timing diagram
header Diagramme de Temps - Publication de Chapitre et Notifications en Temps RÃ©el

robust "Author" as A
concise "Novel Status" as NS
robust "Chapter Service" as CS
robust "Notification Service" as NtS
robust "WebSocket Server" as WS
concise "Reader 1 (Online)" as R1
concise "Reader 2 (Offline)" as R2
concise "Reader 3 (Online)" as R3

@0
A is Idle
NS is Active
CS is Idle
NtS is Idle
WS is Connected
R1 is Browsing
R2 is Offline
R3 is Reading

@+50
A is "Writing Chapter"
note bottom: Author drafts new chapter

@+200
A is "Click Publish"

@+220
CS is "Validating Content"
note bottom: Anti-spam check\nWord count validation

@+250
CS is "Saving to DB"

@+280
CS is "Chapter Saved"
NS is "Being Updated"

@+300
NtS is "Fetching Subscribers"
note bottom: Query database for\nall novel subscribers

@+350
NtS is "Creating Notifications"

@+380
NtS is "Sending to Queue"

@+400
WS is "Broadcasting"
R1 is "Notification Received"
R3 is "Notification Received"
note bottom: Real-time push via WebSocket

@+420
R1 is "Toast Displayed"
R3 is "Toast Displayed"

@+450
NtS is "Sending Emails"
note bottom: Email sent to offline readers

@+500
R2 is "Email Received"

@+550
A is "Viewing Analytics"
CS is Idle
NtS is Idle
WS is Connected
R1 is "Reading New Chapter"
R2 is Offline
R3 is Browsing

@+800
R2 is "Logs In"

@+820
R2 is "Sees Notification"
note bottom: Notification badge on login

@+850
R2 is "Reading New Chapter"

@1000

@0 <-> @220 : Author prepares content
@220 <-> @280 : Validation & Save (60ms)
@280 <-> @400 : Notification preparation (120ms)
@400 <-> @420 : Real-time delivery (20ms)
@450 <-> @500 : Email delivery (50ms)

@enduml
