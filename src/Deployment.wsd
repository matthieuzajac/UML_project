@startuml deployment diagram
header Diagramme de Déploiement - Architecture Système

skinparam componentStyle rectangle

node "Client Layer" as ClientNode {
    artifact "Web Browser" as WebClient
    artifact "Mobile Application" as MobileClient
}

node "Web Server" as WebServer {
    component "Frontend Application" as Frontend
    note right of Frontend
        Interface utilisateur
        Pages web et assets
    end note
}

node "Application Server" as AppServer {
    component "API Gateway" as APIGateway
    component "REST API" as RestAPI
    component "WebSocket Server" as WSServer
    
    note right of APIGateway
        Point d'entrée unique
        Authentification
        Rate limiting
    end note
}

node "Business Logic Server" as BusinessServer {
    component "User Service" as UserSvc
    component "Content Service" as ContentSvc
    component "Review Service" as ReviewSvc
    component "Notification Service" as NotifSvc
    component "Moderation Service" as ModSvc
    component "Search Service" as SearchSvc
    
    note right of BusinessServer
        Services métier
        Logique applicative
    end note
}

node "Data Storage" as StorageNode {
    database "Primary Database" as PrimaryDB {
        [Users]
        [Novels]
        [Chapters]
        [Reviews]
        [Notifications]
        [Reports]
    }
    
    database "Cache Layer" as Cache {
        [Session Data]
        [Query Cache]
        [Popular Content]
    }
    
    database "Search Index" as SearchDB {
        [Novel Index]
        [Full-Text Search]
    }
    
    note bottom of PrimaryDB
        Base de données relationnelle
        Stockage principal des données
    end note
}

node "File Storage" as FileNode {
    cloud "Object Storage" as ObjectStorage {
        artifact "Cover Images" as Covers
        artifact "User Avatars" as Avatars
    }
    
    note right of ObjectStorage
        Stockage de fichiers
        Images et assets
    end note
}

node "Background Workers" as WorkerNode {
    component "Notification Worker" as NotifWorker
    component "Email Worker" as EmailWorker
    component "Analytics Worker" as AnalyticsWorker
    
    note right of WorkerNode
        Traitement asynchrone
        Jobs en arrière-plan
    end note
}

' Client connections
WebClient --> Frontend : HTTPS
MobileClient --> APIGateway : HTTPS/WSS

' Frontend to API
Frontend --> APIGateway : HTTPS

' API Gateway routing
APIGateway --> RestAPI : HTTP
APIGateway --> WSServer : WebSocket

' API to Services
RestAPI --> UserSvc
RestAPI --> ContentSvc
RestAPI --> ReviewSvc
RestAPI --> SearchSvc
RestAPI --> ModSvc

WSServer --> NotifSvc : Push notifications

' Services to Database
UserSvc --> PrimaryDB : CRUD operations
ContentSvc --> PrimaryDB : CRUD operations
ReviewSvc --> PrimaryDB : CRUD operations
ModSvc --> PrimaryDB : CRUD operations

' Services to Cache
UserSvc --> Cache : Session management
ContentSvc --> Cache : Content caching
SearchSvc --> Cache : Query caching

' Services to Search
SearchSvc --> SearchDB : Search queries
ContentSvc --> SearchDB : Index updates

' Services to Storage
UserSvc --> ObjectStorage : Avatar upload
ContentSvc --> ObjectStorage : Cover images

' Background Workers
NotifSvc --> NotifWorker : Queue jobs
NotifWorker --> PrimaryDB : Update notifications
NotifWorker --> WSServer : Real-time push

EmailWorker --> PrimaryDB : Fetch user data

AnalyticsWorker --> PrimaryDB : Update statistics

@enduml
